---
import demo from '../recart_demo.json';
import '../styles/site.css';

function hasTechnicalDetails(result) {
  return Boolean(
    result.prompt ||
    result.technical_details ||
      result.stage ||
      result.cfg !== undefined ||
      result.steps !== undefined ||
      result.alpha !== undefined
  );
}

function getMetaItems(result) {
  const items = [];

  if (result.stage) items.push(`Stage: ${result.stage}`);
  if (result.cfg !== undefined) items.push(`CFG: ${result.cfg}`);
  if (result.steps !== undefined) items.push(`Steps: ${result.steps}`);
  if (result.alpha !== undefined) items.push(`Alpha: ${result.alpha}`);

  return items;
}
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>RecArt Demo</title>
  </head>
  <body class="site-body">
    <main class="page-shell">
      <header class="section-band rule-top rule-bottom">
        <div class="container">
          <nav class="top-nav" aria-label="Primary">
          <a href="/">Home</a>
          <span> | </span>
          <a href="/recart_demo">recart_demo</a>
          <span> | </span>
          <a href="/resume_temp.pdf" target="_blank" rel="noreferrer">Resume</a>
          </nav>
          <p class="kicker">Image Generation Study</p>
          <h1 class="display-title">{demo.title}</h1>
          <p class="subtitle">Image generation results from my PixArt/SD3-from-scratch training pipeline.</p>
        </div>
      </header>

      <section class="rule-bottom" aria-label="Results">
        {demo.results.map((result) => (
          <article id={result.id} class="result-flow rule-top">
            <div class="result-image-band">
              <div class="container wide">
                {result.image ? (
                  <img class="result-image" src={result.image} alt={result.title} loading="lazy" />
                ) : (
                  <p class="empty-note">[No image path set yet]</p>
                )}
              </div>
            </div>
            <div class="result-detail-band rule-top">
              <div class="container narrow">
                <h3 class="result-title">{result.title}</h3>
                {result.tags?.length > 0 && (
                  <div class="tag-list">
                    {result.tags.map((tag) => <span class="pill-tag">{tag}</span>)}
                  </div>
                )}
                {result.notes && <p class="result-notes">{result.notes}</p>}
                {hasTechnicalDetails(result) && (
                  <details class="detail-toggle">
                    <summary>Technical Details</summary>
                    {result.technical_details ? (
                      <>
                        {getMetaItems(result).length > 0 && (
                          <div class="meta-row">
                            {getMetaItems(result).map((item) => <span class="meta-item">{item}</span>)}
                          </div>
                        )}
                        <pre class="mono-block">{JSON.stringify(result.technical_details, null, 2)}</pre>
                      </>
                    ) : (
                      <>
                        {getMetaItems(result).length > 0 && (
                          <div class="meta-row">
                            {getMetaItems(result).map((item) => <span class="meta-item">{item}</span>)}
                          </div>
                        )}
                        {result.prompt && (
                          <>
                            <p class="kicker">Prompt</p>
                            <pre class="mono-block">{result.prompt}</pre>
                          </>
                        )}
                      </>
                    )}
                  </details>
                )}
              </div>
            </div>
          </article>
        ))}
      </section>

      <section class="section-band rule-bottom">
        <div class="container narrow">
          <h2 class="section-title">TODO</h2>
          <ul class="plain-list">
            {demo.todo.map((item) => <li>{item}</li>)}
          </ul>
        </div>
      </section>
    </main>
  </body>
</html>
